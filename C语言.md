# C语言

## 1. 第一个C语言程序

### 1.1 Hello World

```c
// 导入一个文件 stdio.h htd 是一个标准库，std(standard), i(input), o(output)
// <> 表示导入系统文件， "" 表示导入自定义文件
#include <stdio.h>

// int 整形，如果出现在函数中，表示函数的返回值
// main 表示程序的主函数，程序有且只有一个主函数
int main(){
    // {} 函数体 代码体
    // printf 是 stdio.h 中系统提供的函数 表示在标准输出设备上打印字符串
    printf("hello world");
    // return 如果出现在其他函数中表示函数结束 如果出现在main函数中表示程序结束
    // 0 表示函数的返回值 要和函数返回值类型对应
    return 0;
}
```

### 1.2 使用gcc编译程序

默认情况下，c语言编写的文件后缀是`.c`

```
gcc -o <文件输出路径> <源文件>

C:\Users\19374\Desktop\CTF>gcc -o hello.exe hello.c
```

### 1.3 system 函数

```c
#include <stdlib.h>             // 导入带有 system 函数的头文件
#include <stdio.h>

int main(){
    int result = 0;
    result = system("dir");      // 执行成功返回0，失败返回任意数字；自带输出
    printf("%d\n", result);
    return 0;
}
```

### 1.4 C程序编译过程

#### 1.4.1 C程序编译步骤

1. 预编译：宏定义展开（将常量赋值到所有调用它的地方）、头文件展开（将头文件的内容复制到源文件中）、条件编译等，同时将代码中的注释删除，这里并不会检查语法
2. 编译：检查语法，将预处理后文件编译生成汇编文件
3. 汇编：将汇编文件生成目标文件（二进制文件）
4. 链接：C语言写的程序时需要依赖各种库的，所以编译周会还需要把库连接到最终的可执行程序去

#### 1.4.2 gcc编译过程

**分步编译**

```
预处理：gcc -E hello.c -o hello.i
编译：gcc -S hello.i -o hello.s
汇编：gcc -c hello.s -o hello.o
链接：gcc hello.o -o hello
```

## 2. 数据类型

### 2.1 C语言数据类型分类

![image-20240428235927122](C%E8%AF%AD%E8%A8%80.assets/image-20240428235927122.png)

### 2.2 常量和变量

```c
#include <stdio.h>
#define MAX 100         // 注意：没有分号结尾的（常量）

int main() {
    const int price = 3;		// 定义常量
    float weight = 6.666;

    float sum = price * weight;
    // 占位符 %f 表示输出一个浮点型 float 默认保留6位小数 会四舍五入
    // 占位符 %.2f 表示只保留两位小数 会四舍五入
    printf("%.2f", sum);
    printf("宏定义常量：%d", MAX);
    return 0;
}
```

### 2.3 整形

#### 2.3.1 整形变量的定义和输出

**注意：**C语言不能直接书写二进制

```c
#include <stdio.h>

int main() {
    int a = 100;

    printf("%d\n", a);                 // 100
    printf("8进制：%o\n", a);           // 8进制：144
    printf("十六进制：%x\n", a);         // 十六进制：64
    printf("十六进制：%X\n", a);         // 十六进制：64
    printf("无符号数：%u\n", a);         // 无符号数：100

    int b = 0123;                           // 定义八进制值
    int c = 0xabc;                          // 定义十六进制值
    return 0;
}
```

#### 2.3.2 整形输入

```c
#include <stdio.h>

int main() {
    int a = 0;
    printf("输入一个数并打印：");
    // &运算符 表示取地址运算符
    scanf("%d", &a);
    printf("%d", a);

    return 0;
}
```

#### 2.3.3 整形大小和取值范围

```c
#include <stdio.h>

int main() {
    int a = 10;
    short b = 20;
    long c = 30;
    long long d = 40;

    printf("%d\n", a);
    printf("%hd\n", b);
    printf("%ld\n", c);
    printf("%lld", d);

    return 0;
}
```

### 2.4 Sizeof 关键字

计算类型在内存中占用的字节大小

```c
#include <stdio.h>

int main() {
    printf("%d\n", sizeof (int ));     // 4
    printf("%d\n", sizeof (short ));     // 2
    printf("%d\n", sizeof (long ));     // 4
    printf("%d\n", sizeof (long long ));     // 8
    return 0;
}
```

### 2.5 字符型

字符型变量只能用于存储一个**单一**的字符

字符串变量实际上并不是把改字符本身放到变量内存单元中去，而是**将该字符对应的ASCII编码放到变量的存储单元中**。**char的本质就是一个1字节大小的整形**

```c
#include <stdio.h>

int main() {
    char ch = 'a';
    printf("%c\n", ch);              // a
    printf("%d\n", ch - 32);        // 65
    printf("%c\n", ch - 32);        // A
    printf("%d", sizeof ch);        // 1
    return 0;
}
```

### 2.6 浮点型

实型变量也可以称为浮点型变量，浮点型变量时用来存储小数数值的。在C语言中，浮点型变量分为两种：单精度浮点型（float0）、双精度浮点型（double），但是double型变量所表示的浮点数比float型变量更精确

由于浮点型变量是由有限的存储单元组成的，因此只能提供有限的有效数字。在有效位意外的数字将被舍去，这样可能产生一些误差

不以f结尾的常量时double类型，以f结尾的常量是（如3.14f）是float类型

```c
#include <stdio.h>

int main() {
    float a = 3.14f;
    double b = 3.14;

    printf("a=%f, b=%lf\n", a, b);							\\ a=3.140000, b=3.140000
    printf("size_a=%d, size_b=$d", sizeof(a), sizeof (b));		\\ size_a=4, size_b=$d
    return 0;
}
```

## 3. 计算机内存数值存储方式

### 3.1 原码、反码、补码

**正数的原码反码和补码都是它本身；**

**负数的反码符号位不变，其他位逐位取反**

**负数的补码在反码的基础上+1**

```
# 由于 char 在内存中占位位一个字节，即char 10 可用 8bit表示，且第一位为符号位
# 符号位0表示正数，1表示负数

char 10
原码: 0000 1010
反码: 0000 1010
补码: 0000 1010

char -10
原码: 1000 1010
反码: 1111 0101
补码: 1111 0110
```

**在计算机中，数值一律用补码存储**，即`char 10`在计算机的内存中为`0a`，`char -10`在计算机内存中的表现形式为：`f6`

![image-20240429175056397](C%E8%AF%AD%E8%A8%80.assets/image-20240429175056397.png)

![image-20240429175108711](C%E8%AF%AD%E8%A8%80.assets/image-20240429175108711.png)

在计算机系统中，数值一律用补码来存储，主要原因是：

+ 同一了零的编码
+ 将符号位和其他位同一处理
+ 将减法运算转变位加法运算
+ 两个用补码表示的数相加时，如果最高位（符号位）有进位，则进位被舍弃

```
# 计算机 76 - 32 的运算，由于 76-32=76+(-32)，且计算机没有减法，所以这里需要计算-32的补码
76原码：0100 1100
76反码：0100 1100
76补码：0100 1100

-32原码：1010 0000
-32反码：1101 1111
-32补码：1110 0000

0100 1100
+
1110 0000
=
1 0010 1100 补码  符号位溢出位正数，得：44

同理计算：76-82
76原码：0100 1100
76反码：0100 1100
76补码：0100 1100

-82原码：1101 0010
-82反码：1010 1101
-82补码：1010 1110

0100 1100
+
1010 1110
=
1111 1010 补码	由于是负数，所以需要转回补码
1111 1001 反码
1000 0110 补码    得：-6
```

### 3.2 各个类型的取值范围

以char为例：之所以负数比正数的取值范围多一位是因为`1000 0000 `直接定义为-128

以char为例：`unsigned`由于没有负数，所以也没有符号位，那么取值范围为`2^8`

| 数据类型       | 占用空间 | 取值范围                                    |
| -------------- | -------- | ------------------------------------------- |
| short          | 2字节    | -32768 到 32767 （-2^18 ~ 2^18 - 1）        |
| int            | 4字节    | -2147483648 到 2147483647（-2^31 ~ 2^31-1） |
| long           | 4字节    | -2147483648 到 2147483647（-2^31 ~ 2^31-1） |
| unsigned short | 2字节    | 0 到 65535（0 ~ 2^16-1）                    |
| unsigned int   | 4字节    | 0 到 4294967295（0 ~ 2^32-1）               |
| unsigned long  | 4字节    | 0 到 4294967295（0 ~ 2^32-1）               |

### 3.3 数值溢出

当超过一个数据类型能够存放最大的范围时，数值会溢出

有符号位最高位溢出的区别：符号位溢出会导致数的正负发生改变，但最高数的溢出会导致最高位丢失

```
# 以char为例，char占用的空间位1字节（8bit），那么现在有a=127，b=2，a+b=-127，推理如下：
127补码：0111 1111
2补码：  0000 0010

127+2补码：1000 0001
127+2反码：1000 0000
127+2原码：1111 1111 = -127
```

```c
#include <stdio.h>

int main() {
    char a = 127;
    a = a + 2;

    printf("%d", a);		// -127
    return 0;
}
```

## 4. 字符串格式化输入和输出

### 4.1 字符串常量

+ 字符串时内存中一段连续的char空间，以`\0`（数字0）结尾

+ 字符串常量是由双**引号括**起来的字符序列，如"chaina","C"都是合法的字符串常量

```
字符常量：'a'
字符串常量："a\0"
```

每个字符串的结尾，编译器会自动添加一个结束标志位`\0`，即`"a"`包含两个字符`a`和`\0`

```c
#include <stdio.h>

int main() {
    char a = 'a';       // 字符常量
    char a = "a";       // 报错
    return 0;
}
```

### 4.2 printf函数与getchar函数

3.1.2 常用输出控制符

| 转换说明 | 输出                                                         |
| -------- | ------------------------------------------------------------ |
| %a       | 浮点数、十六进制数和p记数法(C99/C11)                         |
| %A       | 浮点数、十六进制数和p记数法(C99/C11)                         |
| %c       | 单个字符                                                     |
| %d       | 有符号十进制整数                                             |
| %e       | 浮点数，e记数法                                              |
| %E       | 浮点数，e记数法                                              |
| %f       | 浮点数，十进制记数法                                         |
| %g       | 根据值的不同，自动选择%f或%e。%e格式用于指数小于-4或者大于或等于精度时 |
| %G       | 根据值的不同，自动选择%F或%E。%E格式用于指数小于-4或者大于或等于精度时 |
| %i       | 有符号十进制整数（与%d相同）                                 |
| %o       | 无符号八进制整数                                             |
| %p       | 指针                                                         |
|          |                                                              |


​	
​	
%s	字符串
%u	无符号十进制整数
%x	无符号十六进制整数，使用十六进制0f
%X	无符号十六进制整数，使用十六进制0F
%%	打印一个百分号
