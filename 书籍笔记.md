# Python 黑帽子-黑客与渗透测试编程之道

## 1. 基础的网络编程工具

### 1.1 TCP 客户端

```py
import socket

target_host = 'www.httpbin.org'
target_port = 80

client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
client.connect((target_host, target_port))
# 由于本身是TCP协议，且发送的数据是标准的HTTP协议数据，所以会以HTTP协议来打包发送出去
client.send(b'GET /get HTTP/1.1\r\nHost: baidu.com\r\n\r\n')
response = client.recv(4096)
print(response.decode())
client.close()
```

+ `socket.AF_INET`：表示我们将使用标准的IPv4地址或主机名
+ `socket.SOCK_STREAM`：表示这是一个TCP客户端

HTTP GET 请求必须包含以下字段，每个字段以一个回车分割，结尾以两个回车结束：

```
GET /get HTTP/1.1
Host: baidu.com


```

### 1.2 UDP 客户端

```py
import socket

target_host = 'www.httpbin.org'
target_port = 80

client = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
client.connect((target_host, target_port))
client.sendto(b'AAABBBCC', (target_host, target_port))
response = client.recvfrom(4096)

client.close()
```

+ `socket.SOCK_DGRAM`：表示这是一个UDP客户端
+ `recvfrom` ：会返回 消息字符串 还有` (IP address, Port)`

### 1.3 TCP 服务器

```py
import socket
import threading

IP = '0.0.0.0'
PORT = 9998


def main():
    # 创建 Server
    server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    server.bind((IP, PORT))
    # 最多允许5个客户端
    server.listen(5)
    print(f"[*] Listening or {IP}:{PORT}")

    while True:
        # 将接受到的客户端socket对象保存到client变量中，将远程链接的详细信息保存到address变量中
        client, address = server.accept()
        # print(address)        ('127.0.0.1', 55627)
        # print(client)         返回 socket 对象
        print(f"[*] Accepted connection from {address[0]}:{address[1]}")
        # 创建线程
        client_handler = threading.Thread(target=handler_client, args=(client,))
        client_handler.start()


def handler_client(client_socket):
    # 使用上下文管理器，由于这里本身传入的就是Socket对象，所以其实就省略了一句 sock.close()
    with client_socket as sock:
        request = sock.recv(1024)
        print(f"[*] Received: {request.decode('utf-8')}")
        sock.send(b'ACK')


if __name__ == '__main__':
    main()

```

