# Linux各个目录的作用

```bash
/：根目录，位于目录结构的最顶层，包含 Fedora 操作系统中所有的目录和文件。
/bin：又称为二进制目录，包含了那些供系统管理员和普通用户使用的重要 linux 命令的二进制映像。
/boot：存放启动 Linux 时使用的一些核心文件，包括一些连接文件以及镜像文件。
/dev：存放与设备 (包括外设) 有关的文件。
/etc：存放所有系统管理所需要的配置文件和子目录。
/home：存放用户的主目录，每个用户都有自己的用户目录，位置为：/home/用户名。
/lib：存放基本代码库（比如c++库），其作用类似于Windows里的DLL文件。 几乎所有的应用程序都需要用到这些共享库。
/lost+found：一般情况下为空的，系统非法关机后，这里就存放一些文件。
/mnt：临时挂载别的文件系统的，我们可以将光驱挂载在/mnt/上，然后进入该目录就可以查看光驱里的内容了。
/opt：这是给主机额外安装软件所摆放的目录。 比如你安装一个ORACLE数据库则就可以放到这个目录下。 默认是空的。
/proc：这是一个虚拟文件系统（也即虚拟文件系统），存储的是当前内核运行状态的一系列特殊文件。 这个目录是一个虚拟的目录，它是系统内存的映射，我们可以通过直接访问这个目录来获取系统信息。
/root：该目录为系统管理员，也称作超级权限者的用户主目录。
/sbin：只有系统管理员能使用的程序和指令。
/tmp：这个目录是用来存放一些临时文件的。
/usr：用户的很多应用程序和文件都放在这个目录下，类似于windows下的program files目录。
```



# 软件包类型

## 软件包安装方法

| 系统平台                  | 包类型 | 工具          | 在线安装 |
| ------------------------- | ------ | ------------- | -------- |
| RedHat/Centos/Fedora/SUSE | rpm    | rpm、rpmbuild | yum      |
| Ubantu/Debian             | deb    | dpkg          | apt      |



## 二进制包的选择

+ 找不到合适的，就安装更高一级版本的
+ el6兼容el5，el5无法安装el6

### 选择合适的CPU的架构

+ x8664包，只能安装在64位的系统上
+ i386,i586,i686的软件包可以安装在32和64位系统上
+ noarch表示这个软件包与硬件构架无关，可以通用
+ 32位系统不能安装64位包

## 认识源码包

+ 优点：
  + 可以在任意平台上预编译，编译出来的软件包非常适合所在机器
  + 可以在编译的时候，通过配置，对某些功能进行定义，开启或关闭相应的功能

+ 缺点
  + 安装麻烦
  + 卸载麻烦
  + 升级麻烦

### 源码包安装三部曲

```
-prefix=.. Directories to put files in/usr/local 软件家目录
-bindir=.. $prefix/bin 命令的目录
--etcdir=..$prefix/etc 配置文件的目录
--mandir=..$prefix/share/man man 文档路径
--locale=...$prefix/share/locale 语言编码
```

编译：

```
make （使用gcc编辑器进行编译）
```

安装：

```
make install 类似 rpm -ivh
```

# 网络配置

## 网卡配置文件

```bash
[root@samba ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens160
TYPE=Ethernet	# 设备类型
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=dhcp	# DHCP 自动获取IP地址; static 则是静态获取IP地址
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=ens160
UUID=2e64b198-d0fd-4c6d-925c-209b526df159
DEVICE=ens160
ONBOOT=yes	# yes 代表在开机后自动激活网卡：no 代表需要手动激活	
```

# yum源的配置和使用

## yum 源的介绍

yum源：软件包管理器，类似于360软件管家

在互联网上，有着许多的yum仓库原，如：阿里源、华为原等。我们要做的只需要配置好yum源文件，让yum自动寻找

<img src="%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8+%E8%BF%90%E7%BB%B4%E8%BF%9B%E9%98%B6.assets/image-20230517195635400.png" alt="image-20230517195635400" style="zoom:50%;" />

## 本地yum源配置

1. 挂载镜像文件

   **注意：勾选已连接**

<img src="%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8+%E8%BF%90%E7%BB%B4%E8%BF%9B%E9%98%B6.assets/image-20230517204710854.png" alt="image-20230517204710854" style="zoom: 67%;" />

```bash
[root@samba media]# df -h
'文件系统        容量  已用  可用 已用% 挂载点
devtmpfs        1.9G     0  1.9G    0% /dev
tmpfs           1.9G     0  1.9G    0% /dev/shm
tmpfs           1.9G   10M  1.9G    1% /run
tmpfs           1.9G     0  1.9G    0% /sys/fs/cgroup
/dev/nvme0n1p2  9.3G  139M  9.2G    2% /
/dev/nvme0n1p9  7.5G  3.6G  3.9G   49% /usr
/dev/nvme0n1p7  947M   40M  908M    5% /tmp
/dev/nvme0n1p5  7.5G  251M  7.2G    4% /var
/dev/nvme0n1p3  7.5G   86M  7.4G    2% /home
/dev/nvme0n1p1  495M  155M  341M   32% /boot
/dev/nvme0n1p8  500M   16K  500M    1% /boot/efi
tmpfs           376M   16K  376M    1% /run/user/42
tmpfs           376M  3.5M  373M    1% /run/user/0
/dev/sr0        6.7G  6.7G     0  100% /media	# 这里可以看到光盘已成功挂载到了 /media 目录
```



2. 通过挂在的方式将镜像文件挂载到本地一个空目录里

   ```bash
   [root@samba /]# mount /dev/cdrom /media/
   mount: /media: WARNING: device write-protected, mounted read-only.
   ```

   

3. 告诉yum工具去哪个仓库里找相应的软件包（配置yum文件）

   1）清空并备份环境：

   ```shell
   [root@samba yum.repos.d]# pwd
   /etc/yum.repos.d
   [root@samba yum.repos.d]# ls
   redhat.repo
   [root@samba yum.repos.d]# mkdir /backup
   [root@samba yum.repos.d]# mv *.repo /backup/
   ```

​		2）查看软件仓库名和软件仓库路径

```bash
# 由于光盘是挂载到了 /media 这个目录下面，所以我们需要在这里寻找光盘的软件仓库
[root@samba yum.repos.d]# ll /media/
总用量 48
dr-xr-xr-x. 4 root root  2048 4月   4 2019 AppStream	# 软件仓库1
dr-xr-xr-x. 4 root root  2048 4月   4 2019 BaseOS	# 软件仓库2
dr-xr-xr-x. 3 root root  2048 4月   4 2019 EFI
-r--r--r--. 1 root root  8266 3月   1 2019 EULA
-r--r--r--. 1 root root  1455 4月   4 2019 extra_files.json
-r--r--r--. 1 root root 18092 3月   1 2019 GPL
dr-xr-xr-x. 3 root root  2048 4月   4 2019 images
dr-xr-xr-x. 2 root root  2048 4月   4 2019 isolinux
-r--r--r--. 1 root root   103 4月   4 2019 media.repo
-r--r--r--. 1 root root  1669 3月   1 2019 RPM-GPG-KEY-redhat-beta
-r--r--r--. 1 root root  5134 3月   1 2019 RPM-GPG-KEY-redhat-release
-r--r--r--. 1 root root  1796 4月   4 2019 TRANS.TBL
```

3）编辑yum配置文件

```bash
[root@samba yum.repos.d]# pwd
/etc/yum.repos.d
[root@samba yum.repos.d]# vim ded.repo

[BaseOS]	# 软件仓库名（可随便写；不要有特殊符号）
name=BaseOS	# 描述信息（可随便写）
baseurl=file:///media/BaseOS	# 指定软件仓库的所在路径：/media/BaseOS
gpgcheck=0	# 是否开启数字签名验证
enabled=1	# 启动仓库

[AppStream]
name=AppStream
baseurl=file:///media/AppStream
gpgcheck=0
enabled=1
```

3. 安装测试

```bash
# 清空yum缓存
[root@samba yum.repos.d]# yum clean all 
Updating Subscription Management repositories.
Unable to read consumer identity
This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.
12 文件已删除

# 创建yum缓存
[root@samba yum.repos.d]# yum makecache
Updating Subscription Management repositories.
Unable to read consumer identity
This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.
AppStream                                                                                                                                                                     213 MB/s | 5.3 MB     00:00
BaseOS                                                                                                                                                                        264 MB/s | 2.2 MB     00:00
上次元数据过期检查：0:00:01 前，执行于 2023年05月17日 星期三 09时08分41秒。
元数据缓存已建立。
```

# 服务概述

## 一、服务概述

+ 运行在操作系统后台的一个或者多个程序，为系统或者用户提供特定的服务
+ 可靠的、并发的、连续的不间断的运行，随时接受请求
+ 通过交互式提供服务

## 二、Linux下两大服务

### 1.独立服务

+ 独立的进程和独立的启动脚本
+ 启动方式：`systemcrl start serverName`

正是因为带有独立的脚本，所以可以直接使用`systemctl`控制

### 2.依赖服务

+ 没有毒瘤的启动服务，以来于xinetd服务（xinted服务本身是一个独立的服务）
+ 启动方式：`必须启动xinetd服务`

#### 什么是xinetd服务？

+ Extended internet daemon(扩展的网络守护进程)，又叫超级Internet)服务，常用来管理多种轻量级Internet)服务；
+ 作用：唤醒在睡觉的服务，由xinetd管理的服务只有在用到的时候才被唤醒，平时不占用系统资源：支
  持Tcp_Wrappers一种安全策略机制。

#### TCP_Wrappers简介：

TCP_Wrappers.是一个工作在应用层的安全工具，它只能针对某些具体的应用或者服务起到一定的防护作用。比如说ssh FTP等服务的请求，都会先受到TCP_Wrapperst的拦截。

# SSH服务

### SSH登录方式

+ 基于密码认证

  1. Client 向 Server 发起请求
  2. Server 向 Client 发送公钥
  3. Client 使用 Server 发送的公钥加密密码
  4. Server 使用私钥解密密码并判断密码是否正确
  5. 返回登录结果

  + 这种方法无法防御中间人攻击。在第一次登录的时候，会询问是否登录该SSH服务器

+ 基于密钥对登录（免密码）

  1. Client 在本地生成一对非对称密码
  2. Client 将公钥传给 Server
  3. Client 向 Server 发起 SSH 请求，并发送 Client 的公钥
  4. Server 比对 Client 的公钥与一开始发送的是否一致
  5. 一致则生成一串随机字符串并使用 Client 的公钥加密发给 Client
  6. Client 使用私钥解密处随机字符串并发给Server
  7. Server 验证字符串是否正确，并返回登录结果

### SSH密钥对登录配置流程

#### 1.Client 本地生成密钥对

```bash
# 客户端在本地生成密钥对
[root@samba ~]# ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa):	# 保存密钥对的文件路径
Created directory '/root/.ssh'.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:+D8pmNd+esDiEi+R2uK3oVpAjQMYX9byIj0h6paDnZk root@samba.server
The key's randomart image is:
+---[RSA 2048]----+
|+.  o.           |
|.o.=o .          |
| .=o.+           |
|....+ ..         |
|o.o= o..S.       |
|.=E.  +.. o      |
|. . .o.B.o o     |
|   .o.B.=.+ o    |
|  .ooo.= o+=     |
+----[SHA256]-----+

[root@samba ~]# ll .ssh/
总用量 8
-rw-------. 1 root root 1823 5月  18 07:55 id_rsa	# 私钥
-rw-r--r--. 1 root root  399 5月  18 07:55 id_rsa.pub	# 公钥
```

#### 2.Client 上传公钥到Server端

> 上传到哪个用户的家目录，在SSH的时候就会以那个用户身份登录

```bash
# ssh-copy-id -i 公钥文件路径 登录用户@IP地址
[root@samba ~]# ssh-copy-id -i .ssh/id_rsa.pub root@192.168.231.129
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: ".ssh/id_rsa.pub"
The authenticity of host '192.168.231.129 (192.168.231.129)' can't be established.
ECDSA key fingerprint is SHA256:LHhmaYmTXaGoJIUQTKG4VyD32CHbyrM6mbPdVMR6wS8.
Are you sure you want to continue connecting (yes/no)? yes
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@192.168.231.129's password:

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh 'root@192.168.231.129'"
and check to make sure that only the key(s) you wanted were added.
```

#### 3.测试登录

登录成功！不需要密码

```bash
[root@samba ~]# ssh root@192.168.231.129
Activate the web console with: systemctl enable --now cockpit.socket
```

### SSH安全配置

#### 禁止root用户登录

​	了解软件相关知识

```bash
[root@samba ~]# rpm -ql openssh-server
/etc/ssh/sshd_config	# 配置文件
/usr/sbin/sshd	# 二进制命令
```

修改配置文件

```bash
[root@samba ~]# vim /etc/ssh/sshd_config
#LoginGraceTime 2m
#PermitRootLogin yes
PermitRootLogin no
#StrictModes yes
#MaxAuthTries 6
#MaxSessions 10

# 重启服务
[root@samba ~]# systemctl restart sshd.service
```

#### 修改默认端口号

```bash
[root@samba ~]# vim /etc/ssh/sshd_config
#Port 22
Port 10022
#AddressFamily any
#ListenAddress 0.0.0.0
#ListenAddress ::

# 重启服务
[root@samba ~]# systemctl restart sshd.service
```

修改端口号之后，需要做以下操作才能保证SSH正常服务

1. 连接SSH的时候增加 -p 参数指定端口号
2. 防火墙允许 10022 端口号通过

# DHCP 服务器配置

## 软件安装

### 查看软件包名

```bash
[root@samba ~]# yum list |grep dhcp
dhcp-client.x86_64                                   12:4.3.6-30.el8                                   @anaconda
dhcp-common.noarch                                   12:4.3.6-30.el8                                   @anaconda
dhcp-libs.x86_64                                     12:4.3.6-30.el8                                   @anaconda
dhcp-libs.i686                                       12:4.3.6-30.el8                                      BaseOS
dhcp-relay.x86_64                                    12:4.3.6-30.el8                                      BaseOS
dhcp-server.x86_64                                   12:4.3.6-30.el8                                      BaseOS
```

### 安装软件包

```bash
[root@samba ~]# yum -y install dhcp-server.x86_64
```

### 查看服务相关文件

```
[root@samba ~]# rpm -ql dhcp-server.x86_64
/etc/dhcp
/etc/dhcp/dhcpd.conf	# 配置文件
/usr/sbin/dhcpd	# 二进制命令
```

### 编辑配置文件

```bash
[root@samba ~]# cat /etc/dhcp/dhcpd.conf
#
# DHCP Server Configuration file.
#   see /usr/share/doc/dhcp-server/dhcpd.conf.example	# DHCP服务配置参考这个文件
#   see dhcpd.conf(5) man page

option domain-name "itcast.cc";		# 域名配置（可选）
option domain-name-servers 114.114.114.114, 8.8.8.8;		# DNS服务器地址（可选）
default-lease-time 3600;	# 缺省租约
max-lease-time 7200;		# 客户端最大租约
log-facility local7;		# 定义日志设备载体（/var/log/boot.log 输出）

subnet 192.168.231.0 netmask 255.255.255.0 {	# 子网<掩码>
    range 192.168.231.1 192.168.231.100;		# IP 地址池范围
    option routers 192.168.231.129;				# 默认网关
    option broadcast-address 192.168.231.255;	# 广播地址
}
```

缺省租约和客户端最大租约介绍：

​	当客户端的 缺省租约 到期之后，就应该向服务器进行IP地址的续期。如果客户端没有这么做，那么最多到 客户端最大租约 时间，IP地址就会失效，服务器就会回收IP地址

# FTP服务配置

## 软件安装-Server

### 安装vsftpd

```bash
[root@samba ~]# yum install -y vsftpd
```

### 了解文件列表

```bash
[root@samba ~]# rpm -ql vsftpd
/etc/logrotate.d/vsftpd	# 日志轮转文件
/etc/pam.d/vsftpd		# 安全认证相关文件
/etc/vsftpd				# 配置文件主目录
/etc/vsftpd/ftpusers	# 用户列表文件（黑名单）
/etc/vsftpd/user_list	# 用户列表文件（黑名单|可黑可白）
/etc/vsftpd/vsftpd.conf	# 主配置文件	
/usr/share/doc/vsftpd/EXAMPLE/VIRTUAL_HOSTS/README		# 虚拟主机
/usr/share/doc/vsftpd/EXAMPLE/VIRTUAL_USERS/README		# 虚拟用户
/usr/share/man/man5/vsftpd.conf.5.gz					# 帮助手册
/usr/share/man/man8/vsftpd.8.gz
```

### 认识配置文件

```bash
[root@samba ~]# grep -v ^# /etc/vsftpd/vsftpd.conf
anonymous_enable=NO		# 支持匿名用户访问
local_enable=YES		# 非匿名用户访问
write_enable=YES		# 是否可写
local_umask=022			# 反掩码	file:644（666）	dir:755（777）
dirmessage_enable=YES	# 启用消息功能（banner）
xferlog_enable=YES		# 启用 xferlog 日志格式
connect_from_port_20=YES	# 支持主动模式（默认是被动模式）；RHEL8 还在使用 xinetd 来管理服务
xferlog_std_format=YES		# xferlog 日志模式
listen=NO					# ftp服务独立模式下的监听
listen_ipv6=YES

pam_service_name=vsftpd		# 必须与 /etc/pam.d/vsftpd 文件名保持一致
userlist_enable=YES			# 启用用户列表
```

### 赋予权限

```bash
chmod o+w /var/ftp/pub/
```



### 防火墙允许FTP服务通过

```bash
[root@samba ~]# firewall-cmd --permanent --add-service=ftp
success
[root@samba ~]# firewall-cmd --reload
success
[root@samba ~]# firewall-cmd --list-all |grep ftp
  services: cockpit dhcpv6-client ftp ssh
```

### 启动服务并开机自启

```bash
[root@samba ~]# systemctl start vsftpd.service
[root@samba ~]# systemctl enable vsftpd.service
Created symlink /etc/systemd/system/multi-user.target.wants/vsftpd.service → /usr/lib/systemd/system/vsftpd.service.
# 查看端口状态
[root@samba ~]# netstat -nltp|grep 21
tcp        0      0 192.168.122.1:53        0.0.0.0:*               LISTEN      2181/dnsmasq
tcp6       0      0 :::21                   :::*                    LISTEN      36258/vsftpd
```

## 软件安装-Client

```bash
[root@samba ~]# yum -y install ftp lftp		# 可以只安装 ftp
```

### 客户端登录

```bash
Name (192.168.231.128:root): ftp
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
```

## 开启本地用户消息功能

> 在哪个用户家目录创建消息文件，哪个用户在登录的时候就会显示消息

### 配置文件开启消息功能

```bash
[root@localhost ~]# grep -v ^# 
dirmessage_enable=YES
```

### 在用户家目录创建消息文件

匿名用户~

```bash
[root@localhost ~]# echo "welcome to anon home" > /var/ftp/.message
```

### 客户端访问

```bash
[root@samba ~]# ftp 192.168.231.130
Connected to 192.168.231.130 (192.168.231.130).
220 (vsFTPd 3.0.3)
Name (192.168.231.130:root): ftp
331 Please specify the password.
Password:
230-welcome to anon home
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
```

## 案例

### 1）允许匿名用户上传文件，并且可以下载其他用户上传的文件

```bash
[root@localhost vsftpd]# vim vsftpd.conf
# Allow anonymous FTP? (Beware - allowed by default if you comment this out).
anonymous_enable=yes		# 允许匿名登录
anon_upload_enable=YES		# 允许匿名上传
anon_umask=022				# 允许匿名用户上传文件
```

### 2）匿名用户上传的文件都保存在 /anon/data 里

```bash
[root@localhost ~]# mkdir /anon/data
[root@localhost ~]# vim /etc/vsftpd/vsftpd.conf
anon_root=/anon/data		# 匿名用户的根目录设置
```

### 3）本地用户上传的文件都保存到 /local/data 里

```bash
[root@localhost ~]# mkdir /local
[root@localhost ~]# mkdir /local/data
[root@localhost ~]# vim /etc/vsftpd/vsftpd.conf
local_root=/local/data		# 本地用户根目录设置
```

### 4）禁止用户访问其他用户的家目录

```bash
[root@localhost ~]# vim /etc/vsftpd/vsftpd.conf
# chroot)
chroot_local_user=YES
```

## FTP访问控制

### 禁止用户访问

要禁止哪个用户访问FTP服务器，就把哪个用户添加到这里就好

```bash
[root@localhost ~]# cat /etc/vsftpd/ftpusers
# Users that are not allowed to login via ftp
root
bin
daemon
adm
lp
sync
shutdown
halt
mail
news
uucp
operator
games
nobody
```

